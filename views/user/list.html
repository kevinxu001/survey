<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8">
	<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	-->
	<title>{$ .SiteName $}</title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<!-- Basic Styles -->
	<link rel="stylesheet" type="text/css" media="screen" href="/static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" media="screen" href="/static/css/font-awesome.min.css">

	<!-- fuelux styles -->
	<link href="/static/fuelux/2.6.1/css/fuelux.min.css" rel="stylesheet" type="text/css">
	<link href="/static/fuelux/2.6.1/css/fuelux-responsive.min.css" rel="stylesheet" type="text/css">

	<!-- ng-grid css -->
	<!-- <link rel="stylesheet" type="text/css" media="screen" href="/static/js/plugin/ng-grid/ng-grid.min.css">
	-->
	<!-- my own css -->
	<link rel="stylesheet" type="text/css" media="screen" href="/static/css/style.css">

	<!-- FAVICONS -->
	<!-- <link rel="shortcut icon" href="/static/smart/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/static/smart/img/favicon/favicon.ico" type="image/x-icon">
	-->
	<!-- GOOGLE FONT -->
	<!-- <link rel="stylesheet" href="http://fonts.useso.com/css?family=Open+Sans:400italic,700italic,300,400,700">
	-->
	<!-- iOS web-app metas : hides Safari UI Components and Changes Status Bar Appearance -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black"></head>
<body>
	<nav class="navbar navbar-default" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">{$ .SiteName $}</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="active">
						<a href="#">Link</a>
					</li>
					<li>
						<a href="#">Link</a>
					</li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							系统管理
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" role="menu">
							<li>
								<a href="/users">用户</a>
							</li>
							<li>
								<a href="#">Another action</a>
							</li>
							<li>
								<a href="#">Something else here</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#">Separated link</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#">One more separated link</a>
							</li>
						</ul>
					</li>
				</ul>
				<form class="navbar-form navbar-left" role="search">
					<div class="form-group">
						<input type="text" class="form-control" placeholder="Search"></div>
					<button type="submit" class="btn btn-default">Submit</button>
				</form>
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="#">Link</a>
					</li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							Dropdown
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" role="menu">
							<li>
								<a href="#">Action</a>
							</li>
							<li>
								<a href="#">Another action</a>
							</li>
							<li>
								<a href="#">Something else here</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#">Separated link</a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>

	<div class="container">
		<ol class="breadcrumb">
			<li>
				<a href="#">首页</a>
			</li>
			<li>
				<a href="#">系统管理</a>
			</li>
			<li class="active">用户</li>
		</ol>

		<div>
			<div class="fuelux col-md-3">
				<h4>学校列表</h4>
				<div id="ou-tree" class="tree" style="height:300px">
					<div class = "tree-folder" style="display:none;">
						<div class="tree-folder-header"> <i class="icon-folder-close"></i>
							<div class="tree-folder-name"></div>
						</div>
						<div class="tree-folder-content"></div>
						<div class="tree-loader" style="display:none"></div>
					</div>
					<div class="tree-item" style="display:none;"> <i class="tree-dot"></i>
						<div class="tree-item-name"></div>
					</div>
				</div>
				<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addOU">新建学校</button>
				<button type="button" class="btn btn-default" data-toggle="modal" data-target="#modifyOU" id="modify">修改学校</button>
				<button type="button" class="btn btn-default" id="delete">删除学校</button>

			</div>

			<div id="addOU" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">
								<span aria-hidden="true">&times;</span>
								<span class="sr-only">关闭</span>
							</button>
							<h4 class="modal-title">新建学校</h4>
						</div>
						<div class="modal-body">
							<form action="/organizations/add" method="post" id="add-organization-form" role="form">
								<div class="form-group">
										<label>
											所属区域
											<div id="organization1" class="select btn-group" data-resize="auto">
												<button type="button" data-toggle="dropdown" class="btn dropdown-toggle">
													<span class="dropdown-label"></span>
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu">
												</ul>
											</div>
										</label>
									</div>

									<div class="form-group">
										<label>
											学校名称
											<input type="text" class="form-control" name="UnitName" placeholder="学校全称"></label>
									</div>

									<div class="form-group">
										<label>排序值
											<input type="number" class="form-control" name="SortRank" value=50 min=1 max=100></label>
									</div>

									<div class="form-group">
										<label>说明
											<input type="textarea" class="form-control" name="Remark"></label>
									</div>

							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
							<button type="button" class="btn btn-primary" id="addButton">新建</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->

			<div id="modifyOU" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">
								<span aria-hidden="true">&times;</span>
								<span class="sr-only">关闭</span>
							</button>
							<h4 class="modal-title">修改学校</h4>
						</div>
						<div class="modal-body">
							<form action="/organizations/modify" method="post" id="modify-organization-form" role="form">
								<div class="form-group">
										<label>
											所属区域
											<div id="organization2" class="select btn-group" data-resize="auto">
												<button type="button" data-toggle="dropdown" class="btn dropdown-toggle">
													<span class="dropdown-label"></span>
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu">
												</ul>
											</div>
										</label>
									</div>

									<div class="form-group">
										<label>
											学校名称
											<input type="text" class="form-control" name="UnitName" placeholder="学校全称"></label>
									</div>

									<div class="form-group">
										<label>排序值
											<input type="number" class="form-control" name="SortRank" value=50 min=1 max=100></label>
									</div>

									<div class="form-group">
										<label>说明
											<input type="textarea" class="form-control" name="Remark"></label>
									</div>

							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
							<button type="button" class="btn btn-primary" id="modifyButton">修改</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->

		</div>
	</div>
	<!-- /.container -->

	<!--================================================== -->

	<!-- PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)
		<script data-pace-options='{ "restartOnRequestAfter": true }' src="/static/smart/js/plugin/pace/pace.min.js"></script>
-->
<!-- Link to Google CDN's jQuery + jQueryUI; fall back to local -->
<script src="/static/js/libs/jquery-2.0.2.min.js"></script>
<!--script>
if (!window.jQuery) {
				document.write('
<script src="/static/js/libs/jquery-2.0.2.min.js"><\/script>
');
			}
</script-->

<script src="/static/js/libs/jquery-ui-1.10.3.min.js"></script>
<!--script>
if (!window.jQuery.ui) {
				document.write('
<script src="/static/js/libs/jquery-ui-1.10.3.min.js"><\/script>
');
			}
</script-->

<!-- MAIN APP JS FILE -->
<script src="/static/js/app.config.js"></script>

<!-- JS TOUCH : include this plugin for mobile drag / drop touch events-->
<script src="/static/js/plugin/jquery-touch/jquery.ui.touch-punch.min.js"></script>

<!-- BOOTSTRAP JS -->
<!--script src="/static/js/bootstrap/bootstrap.min.js">
</script-->

<!-- fuelux js  if use this dont load bootstrap.min.js -->
<script src="/static/fuelux/2.6.1/loader.min.js" type="text/javascript"></script>

<!-- browser msie issue fix -->
<script src="/static/js/plugin/msie-fix/jquery.mb.browser.min.js"></script>

<!--[if IE 8]>
<h1>
Your browser is out of date, please update your browser by going to www.microsoft.com/download
</h1>
<![endif]-->

<!-- AngularJS -->
<!--
		<script src="/static/js/libs/angular/angular.js"></script>
<script src="/static/js/libs/angular/angular-route.js"></script>
<script src="/static/js/libs/angular/angular-animate.js"></script>
<script src="/static/js/libs/angular/ui-bootstrap-custom-tpls-0.11.0.js"></script>
-->
<!-- MAIN APP JS FILE -->
<script src="/static/js/app.js"></script>

<script type="text/javascript">
	$(document).ready(function(){
  		// TREE
  			var dataSourceTree = {};

			dataSourceTree.data = function (options, callback) {
				//console.log(options);
				var pid=options.id||0;
				$.ajax({
					type:"get",
					dataType:"json",
					url:"/organizations",
					data:"pid="+pid,
					complete:function(){},
					success:function(msg){
						var data=[];
						$.each(msg,function(index,value){
							var type='item';
							if(value.Status==0){
								type='folder';
							}
							data.push({name:value.UnitName,type:type,id:value.Id})
						});
						callback({data:data});
					}
				});
			};

			// $('#ou-tree').on('loaded', function (e) {
			// 	console.log('Loaded');
			// });

			$('#ou-tree').tree({
				dataSource: dataSourceTree,
				loadingHTML: '<div class="static-loader">Loading...</div>',
				multiSelect: false,
				cacheItems: true
			});

			// $('#ou-tree').on('selected', function (e, info) {
			// 	console.log('Select Event: ', info);

			// });

			// $('#ou-tree').on('opened', function (e, info) {
			// 	console.log('Open Event: ', info);
			// });

			// $('#ou-tree').on('closed', function (e, info) {
			// 	console.log('Close Event: ', info);
			// });

			// $('#add').on('click',function (e) {
			// 	console.log(e);
			// 	console.log($('#ou-tree').tree('selectedItems'));
			// 	//alert($('#ou-tree').tree('selectedItems')[0].id);
			// })

			//fetch organization list 
			$.ajax({
					type:"get",
					dataType:"json",
					url:"/organizations",
					data:"pid=0",
					complete:function(){},
					success:function(msg){
						$.each(msg,function(index,value){
							if(index==0){
								$('#organization1>ul').append('<li data-value="'+value.Id+'" data-selected="true"><a href="#">'+value.UnitName+'</a></li>');
								$('#organization2>ul').append('<li data-value="'+value.Id+'" data-selected="true"><a href="#">'+value.UnitName+'</a></li>');
							}else{
								$('#organization1>ul').append('<li data-value="'+value.Id+'"><a href="#">'+value.UnitName+'</a></li>');
								$('#organization2>ul').append('<li data-value="'+value.Id+'" data-selected="true"><a href="#">'+value.UnitName+'</a></li>');
							}
						});
						//$('#organization').select();
					}
				});

			//add organization
			$('#addButton').on('click',function(e){
				//console.log($('#add-organization-form')[0]['SortRank'].value);
				//console.log($('#organization').select('selectedItem').value);
				//console.log($('#add-organization-form').serialize()+"&pid="+$('#organization').select('selectedItem').value);
				if($('#organization1').select('selectedItem').value==''){
					alert('必须选择所属区域！');
					return false;
				}
				if($('#add-organization-form')[0]['UnitName'].value==''){
					alert('学校名称不能为空！');
					return false;
				}
				if($('#add-organization-form')[0]['SortRank'].value<1 || $('#add-organization-form')[0]['SortRank'].value>100){
					alert('排序值只能在1到100之间！');
					return false;
				}

				$.ajax({
					type:"post",
					dataType:"json",
					url:"/organizations/add",
					data:$('#add-organization-form').serialize()+"&pid="+$('#organization1').select('selectedItem').value,
					complete:function(){},
					success:function(msg){
						if(msg.Sueecss==true){
							alert(msg.Msg);
						}else{
							alert(msg.Msg);
							$('#addOU').modal('toggle');
						}
						//$('#organization').select();
					}
				});
			});

			// modify organization
			$('#modify').on('click',function(e){
				console.log($('#ou-tree').tree('selectedItems'));
			});

			$('#modifyButton').on('click',function(e){
				//console.log($('#add-organization-form')[0]['SortRank'].value);
				//console.log($('#organization').select('selectedItem').value);
				//console.log($('#add-organization-form').serialize()+"&pid="+$('#organization').select('selectedItem').value);
				if($('#organization2').select('selectedItem').value==''){
					alert('必须选择所属区域！');
					return false;
				}
				if($('#modify-organization-form')[0]['UnitName'].value==''){
					alert('学校名称不能为空！');
					return false;
				}
				if($('#modify-organization-form')[0]['SortRank'].value<1 || $('#add-organization-form')[0]['SortRank'].value>100){
					alert('排序值只能在1到100之间！');
					return false;
				}

				$.ajax({
					type:"post",
					dataType:"json",
					url:"/organizations/modify",
					data:$('#modify-organization-form').serialize()+"&pid="+$('#organization2').select('selectedItem').value,
					complete:function(){},
					success:function(msg){
						if(msg.Sueecss==true){
							alert(msg.Msg);
						}else{
							alert(msg.Msg);
							$('#modifyOU').modal('toggle');
						}
						//$('#organization').select();
					}
				});
			});

});
</script>

<!-- MAIN ANGULAR JS FILE -->
<!--
	  	<script src="/static/js/ng/ng.app.js"></script>
<script src="/static/js/ng/ng.controllers.js"></script>
<script src="/static/js/ng/ng.directives.js"></script>
-->
</body>

</html>